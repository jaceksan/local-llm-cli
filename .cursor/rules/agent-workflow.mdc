---
description: Agent workflow + guardrails for this repo
alwaysApply: true
---

## Repo context (brief)

- Purpose: a local CLI demo for running a “thinking” LLM, with an optional thinking-token cap.
- Entry points: `run.py` / `python -m app`.
- Structure: `app/cli.py` (CLI + interactive loop), `app/model.py` (device/model loading), `app/generation.py` (generation + thinking cap).
- Tooling: `uv` + `Makefile` targets for common workflows.

## Workflow

- Follow the existing design in this repo; don’t reinvent patterns.
- After implementing a user request, validate via `make` (not ad-hoc commands).
- Prefer auto-fix immediately: `make format-fix lint-fix` (and `make test` when relevant).
- Do not commit or push unless the user explicitly asks.
- Stop after completing one task/change-set and ask whether it should be committed before continuing to the next task.
- If fixing something introduced by an earlier local (not-yet-pushed) commit, prefer a fixup-style commit.

## Code changes

- Keep diffs small and focused.
- Prefer robust correctness first; optimize only after correctness is verified.

## Running validations (use Make)

- `make format-fix` then `make lint-fix` (preferred over check-only).
- `make test` for unit tests; `make test-integration` only when explicitly requested/opted-in.

## uv/pytest pitfall

- Prefer `make test`; if invoking directly, use `uv run python -m pytest ...` (not `uv run pytest ...`).
